# hsearch
Парсер на GoLang форума diesel.elcat.kg для поиска нужной мне квартиры. Пишется
 одним разработчиком и код пока не готов к опенсоурс. Но если хочется боли, без
 документации и тестов (они будут), то го.

> Парсер написан на скорую руку и не является примером Go приложения. Он решает
> только одну проблему и его пакеты не могут быть использованны для других
> приложений/библиотек. Go приложения пишутся не так!

## Какую проблему решает бот?
diesel не предоставляет инструментов для отсеивания уже просмотренных тем и
 это стало не удобным для меня. Мне нужно найти хорошую квартиру и если я найду
 ее раньще других, это будут хорошо для меня. **Пожалуйста, не используйте бота
 в риелторских целях.**

## Как он работает
Планируется что бот будет обслуживать нескольких пользователей, а ходить в
 дизедь каждый раз нет смысла. По этому content manager ходит за контентом раз
 в минуту и тащит новые или не очень объявления и пишет в локальную бд на 2
 недели. Дальше пользователь открывает бота, говорит что хочит посмотреть
 объявления и погнали ответы "да", "нет" и т.д.

## Developer documentation
The project supports go modules
```shell script
git clone https://github.com/comov/hsearch.git
cd hsearch
make mod
make migrate
make run
```

Build with Docker 
```shell script
make dockerbuild
```

Run with Docker
```shell script
make dockerrun
```

For more information, take a look at Makefile

## TODO: баги, фичи, замечания которые нужно исправить
 - [ ] пройтись по всем туду в коде!
 - [ ] Реализовать skip (переотправить через N времени)
 - [ ] Переделать dislike (удалить из истории и никогда не показывать )
 - [ ] Изучить, может ли телеграмм менять кнопки уже отправленных сообщений
       (Если пользователь нажал к примеру на кнопку "Фото", мы меняем текс, а
        потом отправляем фото, затем восстанавливаем текст "Фото". Приминений к
        этой фиче куча.)
 - [ ] Реализовать bookmarks
 - [ ] Рассмотреть вариант отправки фото + заголовок + цена и кнопки: описание,
       ссылка, телефон
 - [ ] Попробовать переделать кнопки ответов и вшить в них offerId
 - [ ] Сделать кастомный тип для поля Offer.Images который len берет их бд, а
       list берет из бд
 - [x] Починить отправку фото, если фото много. Сейчас приходит ошибка
       "[photo.Send] error: Bad Request: too much messages to send as an album"
 - [ ] Во всем sql нужно настроить алиасы для таблиц, а то читать не удобно
 - [ ] Для чатов не заполняется Username
 - [ ] После переименовывания и удаления некоторых колонок в бд, некоторые из
        методов стали выглядет бесполезно, к примеру ReadUser. Стоит почистить
 - [ ] При ответе на сообщение бота, бот отвечает "Нет среди доступных команд"
        и нужно исправить это поведение и не отвечать
 - [ ] Нужно начать вести CHANGELOG.md и версионность
 - [ ] Адекватное ведение логов
 - [ ] Добавить lalafo для поиска квартир
 - [ ] Добавить stroka для поиска квартир
 - [ ] Добавить в build тег и дату последней сборки
